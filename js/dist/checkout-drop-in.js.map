{"version":3,"sources":["../src/checkout-drop-in.js"],"names":["send_request","url","data","fetch","method","cache","headers","body","JSON","stringify","validate_response","response","json","then","status","Error","message","cause","process_response","action","dropin","handleAction","resultCode","paymentResult","handle_error","error","name","pronamicPayAdyenCheckout","syntaxError","setStatus","getPaymentMethodsConfiguration","paymentMethodsConfiguration","applepay","applePayMerchantValidationUrl","onValidateMerchant","resolve","reject","validationUrl","validation_url","statusMessage","catch","paypal","onCancel","checkout","AdyenCheckout","configuration","create","onSelect","showPayButton","submit","onSubmit","state","paymentsUrl","onAdditionalDetails","paymentsDetailsUrl","mount","paymentAuthorised","window","location","href","paymentReturnUrl","refusalReason","refusalRedirectUrl","unknownError","paymentRefused","paymentReceived","setTimeout"],"mappings":"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","sourcesContent":["/* global AdyenCheckout, pronamicPayAdyenCheckout */\n( function () {\n\t'use strict';\n\n\t/**\n\t * Send request using Fetch API.\n\t */\n\tconst send_request = ( url, data ) => {\n\t\treturn fetch(\n\t\t\turl,\n\t\t\t{\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcache: 'no-cache',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify( data )\n\t\t\t}\n\t\t);\n\t};\n\n\t/**\n\t * Parse JSON and check response status.\n\t *\n\t * @param response Fetch request response.\n\t * @link https://stackoverflow.com/questions/47267221/fetch-response-json-and-response-status\n\t */\n\tconst validate_response = response => {\n\t\treturn response.json()\n\t\t\t.then( data => {\n\t\t\t\tif ( 200 !== response.status ) {\n\t\t\t\t\tthrow new Error( data.message, {\n\t\t\t\t\t\tcause: data\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\treturn data;\n\t\t\t} );\n\t};\n\n\t/**\n\t * Process response.\n\t *\n\t * @param data Object from JSON response.\n\t */\n\tconst process_response = data => {\n\t\t// Handle action object.\n\t\tif ( data.action ) {\n\t\t\tdropin.handleAction( data.action );\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Handle result code.\n\t\tif ( data.resultCode ) {\n\t\t\tpaymentResult( data );\n\t\t}\n\t}\n\n\t/**\n\t * Handle error.\n\t *\n\t * @param error\n\t */\n\tconst handle_error = error => {\n\t\t// Check syntax error name.\n\t\tif ( 'SyntaxError' === error.name ) {\n\t\t\terror.message = pronamicPayAdyenCheckout.syntaxError;\n\t\t}\n\n\t\t// Show error message.\n\t\tdropin.setStatus( 'error', { message: error.message } );\n\t}\n\n\t/**\n\t * Get payment methods configuration.\n\t *\n\t * @return object\n\t */\n\tconst getPaymentMethodsConfiguration = () => {\n\t\t/**\n\t\t * Complement Apple Pay configuration with `onValidateMerchant`\n\t\t * callback when using your own Apple Pay certificate.\n\t\t * \n\t\t * @link https://github.com/pronamic/wp-pronamic-pay-adyen/issues/5#issue-1154083692\n\t\t */\n\t\tif ( pronamicPayAdyenCheckout.paymentMethodsConfiguration.applepay && pronamicPayAdyenCheckout.applePayMerchantValidationUrl ) {\n\t\t\tpronamicPayAdyenCheckout.paymentMethodsConfiguration.applepay.onValidateMerchant = ( resolve, reject, validationUrl ) => {\n\t\t\t\tsend_request(\n\t\t\t\t\tpronamicPayAdyenCheckout.applePayMerchantValidationUrl,\n\t\t\t\t\t{\n\t\t\t\t\t\tvalidation_url: validationUrl\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.then( validate_response )\n\t\t\t\t.then( data => {\n\t\t\t\t\t// Handle Apple error.\n\t\t\t\t\tif ( data.statusMessage ) {\n\t\t\t\t\t\tthrow new Error( data.statusMessage, {\n\t\t\t\t\t\t\tcause: data\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( data );\n\t\t\t\t} )\n\t\t\t\t.catch( error => {\n\t\t\t\t\thandle_error( error );\n\n\t\t\t\t\t// Reject to dismiss Apple Pay overlay.\n\t\t\t\t\treject( error );\n\t\t\t\t} );\n\t\t\t};\n\t\t}\n\n\t\t// Compliment PayPal configuration.\n\t\tif ( pronamicPayAdyenCheckout.paymentMethodsConfiguration.paypal ) {\n\t\t\tpronamicPayAdyenCheckout.paymentMethodsConfiguration.paypal.onCancel = ( data, dropin ) => {\n\t\t\t\tdropin.setStatus( 'ready' );\n\t\t\t};\n\t\t}\n\n\t\treturn pronamicPayAdyenCheckout.paymentMethodsConfiguration;\n\t};\n\n\t/**\n\t * Adyen Checkout.\n\t */\n\tconst checkout = new AdyenCheckout( pronamicPayAdyenCheckout.configuration );\n\n\tconst dropin = checkout.create( 'dropin', {\n\t\tpaymentMethodsConfiguration: getPaymentMethodsConfiguration(),\n\t\tonSelect: dropin => {\n\t\t\tlet configuration = pronamicPayAdyenCheckout.configuration;\n\n\t\t\tif ( false === configuration.showPayButton ) {\n\t\t\t\tdropin.submit();\n\t\t\t}\n\t\t},\n\t\tonSubmit: ( state ) => {\n\t\t\t// Set loading status to prevent duplicate submits.\n\t\t\tdropin.setStatus( 'loading' );\n\n\t\t\tsend_request(\n\t\t\t\tpronamicPayAdyenCheckout.paymentsUrl,\n\t\t\t\tstate.data\n\t\t\t)\n\t\t\t.then( validate_response )\n\t\t\t.then( process_response )\n\t\t\t.catch( handle_error );\n\t\t},\n\t\tonAdditionalDetails: ( state ) => {\n\t\t\tsend_request(\n\t\t\t\tpronamicPayAdyenCheckout.paymentsDetailsUrl,\n\t\t\t\tstate.data\n\t\t\t)\n\t\t\t.then( validate_response )\n\t\t\t.then( process_response )\n\t\t\t.catch( handle_error );\n\t\t}\n\t} )\n\t.mount( '#pronamic-pay-checkout' );\n\n\t/**\n\t * Handle payment result.\n\t *\n\t * @param response Object from JSON response data.\n\t * @link https://docs.adyen.com/checkout/drop-in-web#step-6-present-payment-result\n\t */\n\tconst paymentResult = response => {\n\t\tswitch ( response.resultCode ) {\n\t\t\tcase 'Authorised':\n\t\t\t\t// The payment was successful.\n\t\t\t\tdropin.setStatus( 'success', { message: pronamicPayAdyenCheckout.paymentAuthorised } );\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that the payment was successful.\n\t\t\t\t */\n\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.paymentReturnUrl;\n\n\t\t\t\tbreak;\n\t\t\tcase 'Error':\n\t\t\t\t// Inform the shopper that there was an error processing their payment.\n\n\t\t\t\t/*\n\t\t\t\t * You'll receive a `refusalReason` in the same response, indicating the cause of the error.\n\t\t\t\t */\n\t\t\t\tif ( response.refusalReason ) {\n\t\t\t\t\tif ( pronamicPayAdyenCheckout.refusalRedirectUrl ) {\n\t\t\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.refusalRedirectUrl;\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow new Error( response.refusalReason );\n\t\t\t\t}\n\n\t\t\t\tthrow new Error( pronamicPayAdyenCheckout.unknownError );\n\t\t\tcase 'Pending':\n\t\t\t\t// The shopper has completed the payment but the final result is not yet known.\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that you've received their order, and are waiting for the payment to be completed.\n\t\t\t\t */\n\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.paymentReturnUrl;\n\n\t\t\t\tbreak;\n\t\t\tcase 'PresentToShopper':\n\t\t\t\t// Present the voucher or the QR code to the shopper.\n\n\t\t\t\t/*\n\t\t\t\t * For a voucher payment method, inform the shopper that you are waiting for their payment. You will receive the final result of the payment in an AUTHORISATION notification.\n\t\t\t\t *\n\t\t\t\t * For a qrCode payment method, wait for the AUTHORISATION notification before presenting the payment result to the shopper.\n\t\t\t\t *\n\t\t\t\t * @todo\n\t\t\t\t */\n\t\t\t\tbreak;\n\t\t\tcase 'Refused':\n\t\t\t\t// The payment was refused.\n\n\t\t\t\tif ( pronamicPayAdyenCheckout.refusalRedirectUrl ) {\n\t\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.refusalRedirectUrl;\n\t\t\t\t}\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that the payment was refused. Ask the shopper to try the payment again using a different payment method or card.\n\t\t\t\t */\n\t\t\t\tif ( response.refusalReason ) {\n\t\t\t\t\tthrow new Error( pronamicPayAdyenCheckout.paymentRefused + ' (' + response.refusalReason + ')' );\n\t\t\t\t}\n\n\t\t\t\tthrow new Error( pronamicPayAdyenCheckout.paymentRefused );\n\t\t\tcase 'Received':\n\t\t\t\t// For some payment methods, it can take some time before the final status of the payment is known.\n\t\t\t\tdropin.setStatus( 'success', { message: pronamicPayAdyenCheckout.paymentReceived } );\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that you've received their order, and are waiting for the payment to clear.\n\t\t\t\t */\n\t\t\t\tsetTimeout(\n\t\t\t\t\t() => {\n\t\t\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.paymentReturnUrl;\n\t\t\t\t\t},\n\t\t\t\t\t3000\n\t\t\t\t);\n\n\t\t\t\tbreak;\n\t\t}\n\t};\n} )();\n"],"file":"checkout-drop-in.js"}