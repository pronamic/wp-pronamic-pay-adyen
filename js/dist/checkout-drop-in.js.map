{"version":3,"sources":["../src/checkout-drop-in.js"],"names":["checkout","AdyenCheckout","pronamicPayAdyenCheckout","configuration","validate_http_status","response","status","Promise","resolve","reject","Error","statusText","get_json","json","paymentMethodsConfiguration","applepay","onValidateMerchant","validationUrl","send_request","applePayMerchantValidationUrl","validation_url","then","data","error","statusMessage","catch","dropin","setStatus","message","setTimeout","paypal","onCancel","validate_response","cause","create","onSelect","hasOwnProperty","showPayButton","submit","onSubmit","state","paymentsUrl","action","handleAction","resultCode","paymentResult","onAdditionalDetails","paymentsDetailsUrl","mount","url","fetch","method","cache","headers","body","JSON","stringify","paymentAuthorised","window","location","href","paymentReturnUrl","refusalReason","paymentRefused","paymentReceived"],"mappings":"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","sourcesContent":["/* global AdyenCheckout, pronamicPayAdyenCheckout */\n( function () {\n\t'use strict';\n\n\tconst checkout = new AdyenCheckout( pronamicPayAdyenCheckout.configuration );\n\n\tconst validate_http_status = response => {\n\t\tif ( response.status >= 200 && response.status < 300 ) {\n\t\t\treturn Promise.resolve( response );\n\t\t}\n\n\t\treturn Promise.reject( new Error( response.statusText ) );\n\t};\n\n\tconst get_json = response => response.json();\n\n\tif ( pronamicPayAdyenCheckout.paymentMethodsConfiguration.applepay ) {\n\t\tpronamicPayAdyenCheckout.paymentMethodsConfiguration.applepay.onValidateMerchant = ( resolve, reject, validationUrl ) => {\n\t\t\tsend_request( pronamicPayAdyenCheckout.applePayMerchantValidationUrl, { validation_url: validationUrl } )\n\t\t\t\t.then( validate_http_status )\n\t\t\t\t.then( get_json )\n\t\t\t\t.then( data => {\n\t\t\t\t\t// Handle Pronamic Pay error.\n\t\t\t\t\tif ( data.error ) {\n\t\t\t\t\t\treturn Promise.reject( new Error( data.error ) );\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handle Adyen error.\n\t\t\t\t\tif ( data.statusMessage ) {\n\t\t\t\t\t\treturn Promise.reject( new Error( data.statusMessage ) );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn resolve( data );\n\t\t\t\t} )\n\t\t\t\t.catch( error => {\n\t\t\t\t\tdropin.setStatus( 'error', { message: error.message } );\n\n\t\t\t\t\tsetTimeout( () => {dropin.setStatus( 'ready' );}, 5000 );\n\n\t\t\t\t\treturn reject();\n\t\t\t\t} );\n\t\t};\n\t}\n\n\tif ( pronamicPayAdyenCheckout.paymentMethodsConfiguration.paypal ) {\n\t\tpronamicPayAdyenCheckout.paymentMethodsConfiguration.paypal.onCancel = ( data, dropin ) => {\n\t\t\tdropin.setStatus( 'ready' );\n\t\t};\n\t}\n\n\t/**\n\t * Parse JSON and check response status.\n\t * \n\t * @link https://stackoverflow.com/questions/47267221/fetch-response-json-and-response-status\n\t */\n\tconst validate_response = response => {\n\t\treturn response.json().then( data => {\n\t\t\tif ( 200 !== response.status ) {\n\t\t\t\tthrow new Error( data.message, {\n\t\t\t\t\tcause: data\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn data;\n\t\t} );\n\t};\n\n\tconst dropin = checkout.create( 'dropin', {\n\t\tpaymentMethodsConfiguration: pronamicPayAdyenCheckout.paymentMethodsConfiguration,\n\t\tonSelect: ( dropin ) => {\n\t\t\tlet configuration = pronamicPayAdyenCheckout.configuration;\n\n\t\t\tif ( configuration.hasOwnProperty( 'showPayButton' ) && false === configuration.showPayButton ) {\n\t\t\t\tdropin.submit();\n\t\t\t}\n\t\t},\n\t\tonSubmit: ( state, dropin ) => {\n\t\t\t// Set loading status to prevent duplicate submits.\n\t\t\tdropin.setStatus( 'loading' );\n\n\t\t\tsend_request( pronamicPayAdyenCheckout.paymentsUrl, state.data )\n\t\t\t.then( validate_response )\n\t\t\t.then( data => {\n\t\t\t\t// Handle action object.\n\t\t\t\tif ( data.action ) {\n\t\t\t\t\tdropin.handleAction( data.action );\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Handle result code.\n\t\t\t\tif ( data.resultCode ) {\n\t\t\t\t\tpaymentResult( data );\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.catch( error => {\n\t\t\t\tdropin.setStatus( 'error', { message: error.message } );\n\t\t\t} );\n\t\t},\n\t\tonAdditionalDetails: ( state, dropin ) => {\n\t\t\tsend_request( pronamicPayAdyenCheckout.paymentsDetailsUrl, state.data )\n\t\t\t.then( validate_http_status )\n\t\t\t.then( get_json )\n\t\t\t.then( data => {\n\t\t\t\t// Handle action object.\n\t\t\t\tif ( data.action ) {\n\t\t\t\t\tdropin.handleAction( data.action );\n\t\t\t\t}\n\n\t\t\t\t// Handle result code.\n\t\t\t\tif ( data.resultCode ) {\n\t\t\t\t\tpaymentResult( data );\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.catch( error => {\n\t\t\t\tthrow Error( error );\n\t\t\t} );\n\t\t}\n\t} )\n\t.mount( '#pronamic-pay-checkout' );\n\n\tconst send_request = ( url, data ) => {\n\t\treturn fetch(\n\t\t\turl,\n\t\t\t{\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcache: 'no-cache',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify( data )\n\t\t\t}\n\t\t);\n\t};\n\n\tconst paymentResult = ( response ) => {\n\t\t/*\n\t\t * Handle payment result\n\t\t *\n\t\t * @link https://docs.adyen.com/checkout/drop-in-web#step-6-present-payment-result\n\t\t */\n\t\tswitch ( response.resultCode ) {\n\t\t\tcase 'Authorised':\n\t\t\t\t// The payment was successful.\n\t\t\t\tdropin.setStatus( 'success', { message: pronamicPayAdyenCheckout.paymentAuthorised } );\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that the payment was successful.\n\t\t\t\t */\n\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.paymentReturnUrl;\n\n\t\t\t\tbreak;\n\t\t\tcase 'Error':\n\t\t\t\t// Inform the shopper that there was an error processing their payment.\n\n\t\t\t\t/*\n\t\t\t\t * You'll receive a `refusalReason` in the same response, indicating the cause of the error.\n\t\t\t\t */\n\t\t\t\tif ( response.refusalReason ) {\n\t\t\t\t\tdropin.setStatus( 'error', { message: response.refusalReason } );\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'Pending':\n\t\t\t\t// The shopper has completed the payment but the final result is not yet known.\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that you've received their order, and are waiting for the payment to be completed.\n\t\t\t\t */\n\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.paymentReturnUrl;\n\n\t\t\t\tbreak;\n\t\t\tcase 'PresentToShopper':\n\t\t\t\t// Present the voucher or the QR code to the shopper.\n\n\t\t\t\t/*\n\t\t\t\t * For a voucher payment method, inform the shopper that you are waiting for their payment. You will receive the final result of the payment in an AUTHORISATION notification.\n\t\t\t\t *\n\t\t\t\t * For a qrCode payment method, wait for the AUTHORISATION notification before presenting the payment result to the shopper.\n\t\t\t\t *\n\t\t\t\t * @todo\n\t\t\t\t */\n\t\t\t\tbreak;\n\t\t\tcase 'Refused':\n\t\t\t\t// The payment was refused.\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that the payment was refused. Ask the shopper to try the payment again using a different payment method or card.\n\t\t\t\t */\n\t\t\t\tdropin.setStatus( 'error', { message: pronamicPayAdyenCheckout.paymentRefused + ' (' + response.refusalReason + ')' } );\n\n\t\t\t\tsetTimeout(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tdropin.setStatus( 'ready' );\n\t\t\t\t\t},\n\t\t\t\t\t8000\n\t\t\t\t);\n\n\t\t\t\tbreak;\n\t\t\tcase 'Received':\n\t\t\t\t// For some payment methods, it can take some time before the final status of the payment is known.\n\t\t\t\tdropin.setStatus( 'success', { message: pronamicPayAdyenCheckout.paymentReceived } );\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that you've received their order, and are waiting for the payment to clear.\n\t\t\t\t */\n\t\t\t\tsetTimeout(\n\t\t\t\t\t() => {\n\t\t\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.paymentReturnUrl;\n\t\t\t\t\t},\n\t\t\t\t\t3000\n\t\t\t\t);\n\n\t\t\t\tbreak;\n\t\t}\n\t};\n} )();\n"],"file":"checkout-drop-in.js"}